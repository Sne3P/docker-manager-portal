# Azure Deployment Script for Container Management Platform (PowerShell)\n# This script deploys the complete infrastructure to Azure from Windows\n#\n# Prerequisites:\n# - Azure CLI installed and logged in  \n# - Terraform installed\n# - Docker Desktop installed\n\n$ErrorActionPreference = \"Stop\"\n\nWrite-Host \"üöÄ Starting Azure deployment for Container Management Platform\" -ForegroundColor Green\n\n# Configuration\n$PROJECT_NAME = \"container-platform\"\n$ENVIRONMENT = \"prod\"\n$RESOURCE_GROUP = \"rg-$PROJECT_NAME-$ENVIRONMENT\"\n\n# Check prerequisites\nWrite-Host \"üìã Checking prerequisites...\" -ForegroundColor Yellow\n\ntry {\n    az --version | Out-Null\n} catch {\n    Write-Host \"‚ùå Azure CLI is not installed. Please install it first.\" -ForegroundColor Red\n    exit 1\n}\n\ntry {\n    terraform --version | Out-Null\n} catch {\n    Write-Host \"‚ùå Terraform is not installed. Please install it first.\" -ForegroundColor Red\n    exit 1\n}\n\ntry {\n    docker --version | Out-Null\n} catch {\n    Write-Host \"‚ùå Docker is not installed. Please install it first.\" -ForegroundColor Red\n    exit 1\n}\n\n# Check Azure login\ntry {\n    az account show | Out-Null\n} catch {\n    Write-Host \"‚ùå Not logged in to Azure. Please run 'az login' first.\" -ForegroundColor Red\n    exit 1\n}\n\nWrite-Host \"‚úÖ All prerequisites satisfied\" -ForegroundColor Green\n\n# Get or create terraform.tfvars\nif (-not (Test-Path \"terraform\\terraform.tfvars\")) {\n    Write-Host \"üìù Creating terraform.tfvars from template...\" -ForegroundColor Yellow\n    Copy-Item \"terraform\\terraform.tfvars.example\" \"terraform\\terraform.tfvars\"\n    \n    Write-Host \"‚ö†Ô∏è  Please edit terraform\\terraform.tfvars and set your values:\" -ForegroundColor Yellow\n    Write-Host \"   - admin_password: Set a secure database password\"\n    Write-Host \"   - project_name: Customize if needed\"\n    Write-Host \"   - location: Set your preferred Azure region\"\n    Write-Host \"\"\n    Write-Host \"Press Enter when ready to continue...\"\n    Read-Host\n}\n\n# Deploy infrastructure\nWrite-Host \"üèóÔ∏è  Deploying infrastructure with Terraform...\" -ForegroundColor Yellow\nSet-Location terraform\n\nterraform init\nterraform plan\nWrite-Host \"ü§î Review the plan above. Press Enter to apply or Ctrl+C to cancel...\" -ForegroundColor Yellow\nRead-Host\n\nterraform apply -auto-approve\n\n# Get outputs\n$REGISTRY_NAME = terraform output -raw container_registry_url\n$BACKEND_URL = terraform output -raw backend_url\n$FRONTEND_URL = terraform output -raw frontend_url\n\nWrite-Host \"üìä Infrastructure deployed successfully!\" -ForegroundColor Green\nWrite-Host \"   Registry: $REGISTRY_NAME\"\nWrite-Host \"   Backend:  $BACKEND_URL\"\nWrite-Host \"   Frontend: $FRONTEND_URL\"\n\nSet-Location ..\n\n# Build and push Docker images\nWrite-Host \"üê≥ Building and pushing Docker images...\" -ForegroundColor Yellow\n\n# Get registry credentials\n$REGISTRY_SHORT_NAME = $REGISTRY_NAME.Split('.')[0]\n$REGISTRY_USER = az acr credential show --name $REGISTRY_SHORT_NAME --query \"username\" -o tsv\n$REGISTRY_PASS = az acr credential show --name $REGISTRY_SHORT_NAME --query \"passwords[0].value\" -o tsv\n\n# Login to registry\necho $REGISTRY_PASS | docker login $REGISTRY_NAME -u $REGISTRY_USER --password-stdin\n\n# Build and push backend\nWrite-Host \"Building backend image...\" -ForegroundColor Yellow\ndocker build -t \"$REGISTRY_NAME/backend:latest\" ./dashboard-backend\ndocker push \"$REGISTRY_NAME/backend:latest\"\n\n# Build and push frontend\nWrite-Host \"Building frontend image...\" -ForegroundColor Yellow\ndocker build -t \"$REGISTRY_NAME/frontend:latest\" ./dashboard-frontend\ndocker push \"$REGISTRY_NAME/frontend:latest\"\n\nWrite-Host \"‚úÖ Images pushed successfully!\" -ForegroundColor Green\n\n# Deploy applications\nWrite-Host \"üöÄ Deploying applications to Azure App Service...\" -ForegroundColor Yellow\n\naz webapp deployment container config --name \"app-$PROJECT_NAME-api-$ENVIRONMENT\" `\n    --resource-group \"$RESOURCE_GROUP\" `\n    --docker-custom-image-name \"$REGISTRY_NAME/backend:latest\" `\n    --docker-registry-server-url \"https://$REGISTRY_NAME\" `\n    --docker-registry-server-user \"$REGISTRY_USER\" `\n    --docker-registry-server-password \"$REGISTRY_PASS\"\n\naz webapp deployment container config --name \"app-$PROJECT_NAME-web-$ENVIRONMENT\" `\n    --resource-group \"$RESOURCE_GROUP\" `\n    --docker-custom-image-name \"$REGISTRY_NAME/frontend:latest\" `\n    --docker-registry-server-url \"https://$REGISTRY_NAME\" `\n    --docker-registry-server-user \"$REGISTRY_USER\" `\n    --docker-registry-server-password \"$REGISTRY_PASS\"\n\n# Wait for deployment\nWrite-Host \"‚è≥ Waiting for applications to start...\" -ForegroundColor Yellow\nStart-Sleep 60\n\n# Health check\nWrite-Host \"üè• Running health check...\" -ForegroundColor Yellow\ntry {\n    Invoke-RestMethod -Uri \"$BACKEND_URL/api/health\" -Method GET | Out-Null\n    Write-Host \"‚úÖ Backend health check passed!\" -ForegroundColor Green\n} catch {\n    Write-Host \"‚ö†Ô∏è  Backend health check failed. Check logs in Azure Portal.\" -ForegroundColor Yellow\n}\n\nWrite-Host \"\"\nWrite-Host \"üéâ Deployment completed successfully!\" -ForegroundColor Green\nWrite-Host \"\"\nWrite-Host \"üìã Application URLs:\" -ForegroundColor Cyan\nWrite-Host \"   Backend API: $BACKEND_URL\" -ForegroundColor White\nWrite-Host \"   Frontend:    $FRONTEND_URL\" -ForegroundColor White\nWrite-Host \"\"\nWrite-Host \"üîê Default login credentials:\" -ForegroundColor Cyan\nWrite-Host \"   Admin: admin / admin123\" -ForegroundColor White\nWrite-Host \"   Client: client1 / client123\" -ForegroundColor White\nWrite-Host \"\"\nWrite-Host \"üìö Next steps:\" -ForegroundColor Cyan\nWrite-Host \"   1. Update default passwords in production\" -ForegroundColor White\nWrite-Host \"   2. Configure custom domain names\" -ForegroundColor White\nWrite-Host \"   3. Set up monitoring and alerts\" -ForegroundColor White\nWrite-Host \"   4. Configure backup policies\" -ForegroundColor White